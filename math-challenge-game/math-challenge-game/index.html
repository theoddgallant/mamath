<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Challenge</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .score {
            font-size: 1.2em;
            color: #666;
        }

        .score span {
            color: #667eea;
            font-weight: bold;
            font-size: 1.5em;
        }

        .difficulty {
            text-align: center;
            margin-bottom: 20px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 10px;
            color: #666;
            font-weight: bold;
        }

        .timer-container {
            margin-bottom: 20px;
            position: relative;
        }

        .timer-bar {
            height: 30px;
            background: linear-gradient(90deg, #ff6b6b, #ffd43b, #51cf66);
            border-radius: 15px;
            transition: width 0.1s linear;
            width: 100%;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .timer-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5em;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .calculation {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }

        .equation {
            font-size: 1.8em;
            color: #333;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .proposed-result {
            font-size: 2.5em;
            color: #667eea;
            font-weight: bold;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .question {
            margin-top: 20px;
            font-size: 1.1em;
            color: #666;
        }

        .buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        button {
            flex: 1;
            padding: 20px;
            font-size: 1.2em;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        button:active {
            transform: translateY(2px);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-lower {
            background: #ff6b6b;
            color: white;
        }

        .btn-lower:hover:not(:disabled) {
            background: #ee5a52;
        }

        .btn-higher {
            background: #51cf66;
            color: white;
        }

        .btn-higher:hover:not(:disabled) {
            background: #40c057;
        }

        .feedback {
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: bold;
            font-size: 1.2em;
            display: none;
        }

        .feedback.show {
            display: block;
        }

        .feedback.correct {
            background: #d3f9d8;
            color: #2b8a3e;
        }

        .feedback.incorrect {
            background: #ffe3e3;
            color: #c92a2a;
        }

        .game-over {
            display: none;
            text-align: center;
        }

        .game-over.show {
            display: block;
        }

        .game-over h2 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 20px;
        }

        .final-score {
            font-size: 3em;
            color: #667eea;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .score-label {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .btn-restart {
            background: #667eea;
            color: white;
            padding: 15px 40px;
            font-size: 1.2em;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-restart:hover {
            background: #5568d3;
        }

        .correct-answer {
            margin-top: 10px;
            font-size: 0.9em;
            color: #666;
        }

        .hidden {
            display: none;
        }

        .welcome-screen {
            text-align: center;
        }

        .welcome-screen.show {
            display: block;
        }

        .welcome-screen h2 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 20px;
        }

        .welcome-screen .subtitle {
            color: #764ba2;
            font-size: 1.3em;
            margin-bottom: 30px;
            font-weight: bold;
        }

        .instructions {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: left;
        }

        .instructions h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .instructions ul {
            list-style: none;
            padding: 0;
        }

        .instructions li {
            padding: 10px 0;
            font-size: 1.1em;
            color: #555;
            line-height: 1.6;
        }

        .instructions li::before {
            content: "‚úì ";
            color: #51cf66;
            font-weight: bold;
            font-size: 1.3em;
            margin-right: 10px;
        }

        .btn-start {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 60px;
            font-size: 1.5em;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 15px rgba(102, 126, 234, 0.3);
            font-weight: bold;
        }

        .btn-start:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-start:active {
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="welcome-screen show" id="welcomeScreen">
            <h2>üßÆ Math Challenge</h2>
            <div class="subtitle">Testez votre rapidit√© en calcul mental !</div>
            
            <div class="instructions">
                <h3>üìñ Comment jouer ?</h3>
                <ul>
                    <li>Un calcul et un r√©sultat s'affichent √† l'√©cran</li>
                    <li>Le r√©sultat propos√© est toujours FAUX</li>
                    <li>Vous devez deviner si le VRAI r√©sultat est plus grand ou plus petit</li>
                    <li>Vous avez seulement 10 secondes pour r√©pondre ‚è±Ô∏è</li>
                    <li>La difficult√© augmente : nombres plus grands, op√©rations multiples üìà</li>
                    <li>Une erreur et c'est perdu... SAUF si vous avez une vie bonus ! üí•</li>
                    <li><strong>üéÅ Bonus :</strong> Tous les 20 niveaux, vous gagnez une vie suppl√©mentaire</li>
                    <li><strong>üéØ Checkpoints :</strong> Vous pouvez recommencer depuis les niveaux 20, 40, 60...</li>
                </ul>
            </div>
            
            <button class="btn-start" id="btnStart">üöÄ Commencer √† jouer</button>
        </div>

        <div class="header hidden" id="gameHeader">
            <h1>üßÆ Math Challenge</h1>
            <div style="display: flex; justify-content: space-around; align-items: center; gap: 20px;">
                <div class="score">Score: <span id="score">0</span></div>
                <div class="score" id="livesDisplay">Vies: <span id="lives" style="color: #ff6b6b;">‚ù§Ô∏è</span></div>
            </div>
        </div>

        <div id="gameActive" class="hidden">
            <div class="difficulty" id="difficulty">Niveau 1</div>
            
            <div class="timer-container">
                <div class="timer-bar" id="timerBar"></div>
                <div class="timer-text" id="timerText">10</div>
            </div>
            
            <div class="calculation">
                <div class="equation" id="equation">5 + 3</div>
                <div class="proposed-result" id="proposedResult">8</div>
                <div class="question">Le vrai r√©sultat est-il...</div>
            </div>

            <div class="feedback" id="feedback">
                <div id="feedbackText">Correct! üéâ</div>
                <div class="correct-answer" id="correctAnswer"></div>
            </div>

            <div class="buttons">
                <button class="btn-lower" id="btnLower">üëá Plus petit</button>
                <button class="btn-higher" id="btnHigher">üëÜ Plus grand</button>
            </div>
        </div>

        <div class="game-over" id="gameOver">
            <h2>Perdu!</h2>
            <div class="final-score" id="finalScore">0</div>
            <div class="score-label">Votre score final</div>
            <div id="checkpointButtons" style="display: flex; flex-direction: column; gap: 15px; max-width: 300px; margin: 20px auto;">
                <button class="btn-restart" id="btnRestart">üîÑ Recommencer au d√©but</button>
            </div>
        </div>
    </div>

    <script>
        let score = 0;
        let currentCalculation = {};
        let level = 1;
        let timeLeft = 10;
        let timerInterval = null;
        let isWaitingForNext = false;
        let lives = 0; // Nombre de vies bonus
        let checkpoints = []; // Liste des checkpoints d√©bloqu√©s (20, 40, 60...)

        const TIMER_DURATION = 10;
        const CHECKPOINT_INTERVAL = 20; // Checkpoint tous les 20 scores

        // Cr√©er les sons du jeu avec Web Audio API
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        let backgroundMusic = null;
        let isMusicPlaying = false;

        // Fonction pour jouer un son de victoire
        function playSuccessSound() {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
            oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
            oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2); // G5
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.4);
        }

        // Fonction pour jouer un son d'√©chec
        function playFailSound() {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(329.63, audioContext.currentTime); // E4
            oscillator.frequency.setValueAtTime(293.66, audioContext.currentTime + 0.15); // D4
            oscillator.frequency.setValueAtTime(246.94, audioContext.currentTime + 0.3); // B3
            
            oscillator.type = 'triangle';
            gainNode.gain.setValueAtTime(0.4, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
        }

        // Fonction pour jouer un son de tic-tac
        function playTickSound() {
            if (timeLeft <= 3 && timeLeft > 0) {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                oscillator.type = 'sine';
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.1);
            }
        }

        // Fonction pour cr√©er et jouer la musique d'ambiance
        function startBackgroundMusic() {
            if (isMusicPlaying) return;
            
            const notes = [
                { freq: 261.63, time: 0 },    // C4
                { freq: 329.63, time: 0.5 },  // E4
                { freq: 392.00, time: 1.0 },  // G4
                { freq: 523.25, time: 1.5 },  // C5
                { freq: 392.00, time: 2.0 },  // G4
                { freq: 329.63, time: 2.5 },  // E4
            ];
            
            function playMusicLoop() {
                if (!isMusicPlaying) return;
                
                notes.forEach(note => {
                    setTimeout(() => {
                        if (!isMusicPlaying) return;
                        
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        
                        oscillator.frequency.setValueAtTime(note.freq, audioContext.currentTime);
                        oscillator.type = 'sine';
                        gainNode.gain.setValueAtTime(0.05, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
                        
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.4);
                    }, note.time * 1000);
                });
                
                setTimeout(playMusicLoop, 3000);
            }
            
            isMusicPlaying = true;
            playMusicLoop();
        }

        function stopBackgroundMusic() {
            isMusicPlaying = false;
        }

        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function updateLivesDisplay() {
            const livesElement = document.getElementById('lives');
            if (lives > 0) {
                livesElement.textContent = '‚ù§Ô∏è'.repeat(lives);
            } else {
                livesElement.textContent = '0';
            }
        }

        function checkForCheckpoint() {
            // V√©rifier si on atteint un multiple de 20
            if (score > 0 && score % CHECKPOINT_INTERVAL === 0) {
                if (!checkpoints.includes(score)) {
                    checkpoints.push(score);
                    lives++; // Gagner une vie
                    updateLivesDisplay();
                    
                    // Sauvegarder dans localStorage
                    localStorage.setItem('mathChallengeCheckpoints', JSON.stringify(checkpoints));
                    
                    // Message visuel
                    showBonusMessage(`üéâ Checkpoint ${score} ! +1 vie bonus !`);
                }
            }
        }

        function showBonusMessage(message) {
            const feedback = document.getElementById('feedback');
            const feedbackText = document.getElementById('feedbackText');
            
            feedback.className = 'feedback show';
            feedback.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            feedback.style.color = 'white';
            feedbackText.textContent = message;
            
            setTimeout(() => {
                feedback.className = 'feedback';
                feedback.style.background = '';
                feedback.style.color = '';
            }, 2000);
        }

        function startTimer() {
            timeLeft = TIMER_DURATION;
            updateTimerDisplay();
            
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            
            let lastSecond = Math.ceil(timeLeft);
            
            timerInterval = setInterval(() => {
                timeLeft -= 0.1;
                
                const currentSecond = Math.ceil(timeLeft);
                if (currentSecond !== lastSecond && currentSecond <= 3 && currentSecond > 0) {
                    playTickSound();
                    lastSecond = currentSecond;
                }
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    timeLeft = 0;
                    updateTimerDisplay();
                    handleTimeout();
                } else {
                    updateTimerDisplay();
                }
            }, 100);
        }

        function updateTimerDisplay() {
            const timerBar = document.getElementById('timerBar');
            const timerText = document.getElementById('timerText');
            
            const percentage = (timeLeft / TIMER_DURATION) * 100;
            timerBar.style.width = percentage + '%';
            timerText.textContent = Math.ceil(timeLeft);
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        function handleTimeout() {
            if (isWaitingForNext) return;
            
            isWaitingForNext = true;
            
            const feedback = document.getElementById('feedback');
            const feedbackText = document.getElementById('feedbackText');
            const correctAnswer = document.getElementById('correctAnswer');
            
            disableButtons();
            
            // V√©rifier si on a des vies
            if (lives > 0) {
                lives--;
                updateLivesDisplay();
                
                playFailSound();
                
                feedback.className = 'feedback show';
                feedback.style.background = '#fff3cd';
                feedback.style.color = '#856404';
                feedbackText.textContent = '‚ö†Ô∏è Temps √©coul√© ! Vous avez utilis√© une vie';
                correctAnswer.textContent = `Le r√©sultat exact √©tait: ${currentCalculation.realResult}`;
                
                setTimeout(() => {
                    feedback.style.background = '';
                    feedback.style.color = '';
                    displayNewCalculation();
                }, 2000);
            } else {
                playFailSound();
                
                feedback.className = 'feedback incorrect show';
                feedbackText.textContent = '‚ùå Perdu! Temps √©coul√©!';
                correctAnswer.textContent = `Le r√©sultat exact √©tait: ${currentCalculation.realResult}`;
                
                setTimeout(() => {
                    gameOver();
                }, 2000);
            }
        }

        function getDifficultyParams(level) {
            if (level <= 3) {
                return { min: 1, max: 20, ops: ['+', '-'], useDecimals: false, useSqrt: false };
            } else if (level <= 6) {
                return { min: 10, max: 50, ops: ['+', '-', '√ó'], useDecimals: false, useSqrt: false };
            } else if (level <= 10) {
                return { min: 20, max: 100, ops: ['+', '-', '√ó', '√∑'], useDecimals: true, useSqrt: false };
            } else if (level <= 15) {
                return { min: 50, max: 200, ops: ['+', '-', '√ó', '√∑'], useDecimals: true, useSqrt: true };
            } else {
                return { min: 100, max: 500, ops: ['+', '-', '√ó', '√∑'], useDecimals: true, useSqrt: true };
            }
        }

        function generateCalculation() {
            const params = getDifficultyParams(level);
            const ops = params.ops;
            
            let num1, num2, num3, realResult, equation;

            // √Ä partir du niveau 7, possibilit√© d'avoir 3 nombres
            const useThreeNumbers = level >= 7 && Math.random() > 0.5;
            
            if (params.useSqrt && Math.random() > 0.7) {
                num1 = getRandomInt(params.min, params.max);
                realResult = Math.sqrt(num1);
                equation = `‚àö${num1}`;
            } else if (useThreeNumbers && ops.length > 1) {
                // Calcul avec 3 nombres
                num1 = getRandomInt(params.min, params.max);
                num2 = getRandomInt(params.min, params.max);
                num3 = getRandomInt(params.min, params.max);
                
                const operation1 = ops[Math.floor(Math.random() * ops.length)];
                const operation2 = ops[Math.floor(Math.random() * ops.length)];
                
                // Calculer le r√©sultat √©tape par √©tape
                let intermediate;
                switch(operation1) {
                    case '+':
                        intermediate = num1 + num2;
                        break;
                    case '-':
                        intermediate = num1 - num2;
                        break;
                    case '√ó':
                        intermediate = num1 * num2;
                        break;
                    case '√∑':
                        num2 = getRandomInt(2, 10);
                        num1 = num2 * getRandomInt(Math.max(1, params.min/10), params.max/10);
                        intermediate = num1 / num2;
                        break;
                }
                
                switch(operation2) {
                    case '+':
                        realResult = intermediate + num3;
                        break;
                    case '-':
                        realResult = intermediate - num3;
                        break;
                    case '√ó':
                        realResult = intermediate * num3;
                        break;
                    case '√∑':
                        num3 = getRandomInt(2, 10);
                        realResult = intermediate / num3;
                        break;
                }
                
                equation = `${num1} ${operation1} ${num2} ${operation2} ${num3}`;
            } else {
                // Calcul avec 2 nombres (comme avant)
                const operation = ops[Math.floor(Math.random() * ops.length)];
                num1 = getRandomInt(params.min, params.max);
                num2 = getRandomInt(params.min, params.max);

                switch(operation) {
                    case '+':
                        realResult = num1 + num2;
                        equation = `${num1} + ${num2}`;
                        break;
                    case '-':
                        realResult = num1 - num2;
                        equation = `${num1} - ${num2}`;
                        break;
                    case '√ó':
                        realResult = num1 * num2;
                        equation = `${num1} √ó ${num2}`;
                        break;
                    case '√∑':
                        num2 = getRandomInt(2, 10);
                        num1 = num2 * getRandomInt(Math.max(1, params.min/10), params.max/10);
                        realResult = num1 / num2;
                        equation = `${num1} √∑ ${num2}`;
                        break;
                }
            }

            if (!params.useDecimals) {
                realResult = Math.round(realResult);
            } else {
                realResult = Math.round(realResult * 100) / 100;
            }

            // G√©n√©rer un r√©sultat propos√© toujours faux
            let proposedResult;
            const randomChoice = Math.random();
            
            if (randomChoice < 0.5) {
                const offset = getRandomInt(1, Math.max(2, Math.floor(Math.abs(realResult) * 0.3)));
                proposedResult = realResult + offset;
            } else {
                const offset = getRandomInt(1, Math.max(2, Math.floor(Math.abs(realResult) * 0.3)));
                proposedResult = realResult - offset;
            }

            if (!params.useDecimals) {
                proposedResult = Math.round(proposedResult);
            } else {
                proposedResult = Math.round(proposedResult * 100) / 100;
            }

            return {
                equation,
                realResult,
                proposedResult
            };
        }

        function displayNewCalculation() {
            isWaitingForNext = false;
            currentCalculation = generateCalculation();
            
            document.getElementById('equation').textContent = currentCalculation.equation;
            document.getElementById('proposedResult').textContent = currentCalculation.proposedResult;
            document.getElementById('difficulty').textContent = `Niveau ${level}`;
            
            const feedback = document.getElementById('feedback');
            feedback.className = 'feedback';
            
            enableButtons();
            startTimer();
        }

        function enableButtons() {
            document.getElementById('btnLower').disabled = false;
            document.getElementById('btnHigher').disabled = false;
        }

        function disableButtons() {
            document.getElementById('btnLower').disabled = true;
            document.getElementById('btnHigher').disabled = true;
        }

        function checkAnswer(answer) {
            if (isWaitingForNext) return;
            
            isWaitingForNext = true;
            stopTimer();
            
            const real = currentCalculation.realResult;
            const proposed = currentCalculation.proposedResult;
            
            let isCorrect = false;
            
            if (answer === 'higher' && real > proposed) {
                isCorrect = true;
            } else if (answer === 'lower' && real < proposed) {
                isCorrect = true;
            }

            const feedback = document.getElementById('feedback');
            const feedbackText = document.getElementById('feedbackText');
            const correctAnswer = document.getElementById('correctAnswer');
            
            disableButtons();

            if (isCorrect) {
                score++;
                level = Math.floor(score / 3) + 1;
                document.getElementById('score').textContent = score;
                
                playSuccessSound();
                
                feedback.className = 'feedback correct show';
                feedbackText.textContent = '‚úÖ Correct!';
                correctAnswer.textContent = `R√©sultat exact: ${real}`;
                
                setTimeout(() => {
                    checkForCheckpoint(); // V√©rifier si on atteint un checkpoint
                    displayNewCalculation();
                }, 1500);
            } else {
                // V√©rifier si on a des vies
                if (lives > 0) {
                    lives--;
                    updateLivesDisplay();
                    
                    playFailSound();
                    
                    feedback.className = 'feedback show';
                    feedback.style.background = '#fff3cd';
                    feedback.style.color = '#856404';
                    feedbackText.textContent = '‚ö†Ô∏è Erreur ! Vous avez utilis√© une vie';
                    correctAnswer.textContent = `Le r√©sultat exact √©tait: ${real}`;
                    
                    setTimeout(() => {
                        feedback.style.background = '';
                        feedback.style.color = '';
                        displayNewCalculation();
                    }, 2000);
                } else {
                    playFailSound();
                    
                    feedback.className = 'feedback incorrect show';
                    feedbackText.textContent = '‚ùå Perdu!';
                    correctAnswer.textContent = `Le r√©sultat exact √©tait: ${real}`;
                    
                    setTimeout(() => {
                        gameOver();
                    }, 2000);
                }
            }
        }

        function gameOver() {
            stopTimer();
            stopBackgroundMusic();
            document.getElementById('gameActive').classList.add('hidden');
            document.getElementById('gameOver').classList.add('show');
            document.getElementById('finalScore').textContent = score;
            
            // Charger les checkpoints sauvegard√©s
            const savedCheckpoints = JSON.parse(localStorage.getItem('mathChallengeCheckpoints') || '[]');
            const checkpointButtons = document.getElementById('checkpointButtons');
            
            // Supprimer les anciens boutons checkpoint
            const oldCheckpointBtns = checkpointButtons.querySelectorAll('.checkpoint-btn');
            oldCheckpointBtns.forEach(btn => btn.remove());
            
            // Ajouter un bouton pour chaque checkpoint d√©bloqu√©
            savedCheckpoints.sort((a, b) => b - a); // Trier par ordre d√©croissant
            savedCheckpoints.forEach(checkpoint => {
                const btn = document.createElement('button');
                btn.className = 'btn-restart checkpoint-btn';
                btn.style.background = '#51cf66';
                btn.textContent = `üéØ Recommencer au niveau ${checkpoint}`;
                btn.onclick = () => restartFromCheckpoint(checkpoint);
                checkpointButtons.appendChild(btn);
            });
        }

        function restartGame() {
            score = 0;
            level = 1;
            lives = 0;
            isWaitingForNext = false;
            document.getElementById('score').textContent = score;
            updateLivesDisplay();
            document.getElementById('gameActive').classList.remove('hidden');
            document.getElementById('gameOver').classList.remove('show');
            startBackgroundMusic();
            displayNewCalculation();
        }

        function restartFromCheckpoint(checkpointScore) {
            score = checkpointScore;
            level = Math.floor(checkpointScore / 3) + 1;
            
            // Calculer le nombre de vies en fonction des checkpoints atteints
            lives = Math.floor(checkpointScore / CHECKPOINT_INTERVAL);
            
            isWaitingForNext = false;
            document.getElementById('score').textContent = score;
            updateLivesDisplay();
            document.getElementById('gameActive').classList.remove('hidden');
            document.getElementById('gameOver').classList.remove('show');
            startBackgroundMusic();
            displayNewCalculation();
        }

        function startGame() {
            // Charger les checkpoints sauvegard√©s
            const savedCheckpoints = JSON.parse(localStorage.getItem('mathChallengeCheckpoints') || '[]');
            checkpoints = savedCheckpoints;
            
            document.getElementById('welcomeScreen').classList.remove('show');
            document.getElementById('welcomeScreen').classList.add('hidden');
            document.getElementById('gameHeader').classList.remove('hidden');
            document.getElementById('gameActive').classList.remove('hidden');
            updateLivesDisplay();
            startBackgroundMusic();
            displayNewCalculation();
        }

        // Event listeners
        document.getElementById('btnStart').addEventListener('click', startGame);
        document.getElementById('btnLower').addEventListener('click', () => checkAnswer('lower'));
        document.getElementById('btnHigher').addEventListener('click', () => checkAnswer('higher'));
        document.getElementById('btnRestart').addEventListener('click', restartGame);
    </script>
</body>
</html>
